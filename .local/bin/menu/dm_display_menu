#!/bin/sh

mirror() {
  external=$(echo "$screens" | menu -p "Optimize resolution for:")
  internal=$(echo "$screens" | grep -v "$external")

  res_external=$(xrandr --query | sed -n "/^$external/,/\+/p" | \
      tail -n 1 | awk '{print $1}')
  res_internal=$(xrandr --query | sed -n "/^$internal/,/\+/p" | \
      tail -n 1 | awk '{print $1}')

  res_ext_x=$(echo $res_external | sed 's/x.*//')
  res_ext_y=$(echo $res_external | sed 's/.*x//')
  res_int_x=$(echo $res_internal | sed 's/x.*//')
  res_int_y=$(echo $res_internal | sed 's/.*x//')

  scale_x=$(echo "$res_ext_x / $res_int_x" | bc -l)
  scale_y=$(echo "$res_ext_y / $res_int_y" | bc -l)

  xrandr --output "$external" --auto --scale 1.0x1.0 \
      --output "$internal" --auto --same-as "$external" \
      --scale "$scale_x"x"$scale_y"
}

screens=$(xrandr -q | grep -w "connected" | awk '{print $1}')
n=$(echo $screens | wc -w)
[ $n -gt 1 ] && mirror="mirror" || mirror=""

chosen=$(dm_choose "Display arangement" auto $mirror "auto prompt" "gui") # $screens
case "$chosen" in
  "auto")        bspwm_multi_monitor ;;
  "auto prompt") bspwm_multi_monitor --prompt ;;
  "mirror")      mirror ;;
	"gui")         arandr ;;
	*) xrandr --output "$chosen" --auto --scale 1.0x1.0 $(echo "$allposs" | grep -v "$chosen" | awk '{print "--output", $1, "--off"}' | tr '\n' ' ') ;;
esac

./$HOME/.fehbg
dunst_start
